{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nimport React, { createContext, useContext, useState } from 'react';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nvar GROQ_CONFIG = {\n  apiUrl: 'https://api.groq.com/openai/v1/chat/completions',\n  model: 'llama-3.1-70b-versatile',\n  maxTokens: 500,\n  temperature: 0.8\n};\nvar AIContext = createContext(null);\nexport var useAI = function useAI() {\n  var context = useContext(AIContext);\n  if (!context) {\n    throw new Error('useAI debe ser usado dentro de AIProvider');\n  }\n  return context;\n};\nexport var AIProvider = function AIProvider(_ref) {\n  var children = _ref.children;\n  var _useState = useState({\n      mode: 'local',\n      endpoint: 'https://api.groq.com/openai/v1/chat/completions',\n      timeout: 30000\n    }),\n    _useState2 = _slicedToArray(_useState, 2),\n    config = _useState2[0],\n    setConfigState = _useState2[1];\n  var _useState3 = useState(''),\n    _useState4 = _slicedToArray(_useState3, 2),\n    apiKey = _useState4[0],\n    setApiKeyState = _useState4[1];\n  var _useState5 = useState(false),\n    _useState6 = _slicedToArray(_useState5, 2),\n    isLoading = _useState6[0],\n    setIsLoading = _useState6[1];\n  var setConfig = function setConfig(newConfig) {\n    setConfigState(function (prev) {\n      return _objectSpread(_objectSpread({}, prev), newConfig);\n    });\n  };\n  var setApiKey = function setApiKey(key) {\n    setApiKeyState(key);\n    if (key) {\n      setConfig({\n        mode: 'groq'\n      });\n    }\n  };\n  var generateResponse = function () {\n    var _ref2 = _asyncToGenerator(function* (message, context) {\n      var mode = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 'entrenamiento';\n      if (config.mode === 'groq' && apiKey) {\n        return callGroqAPI(message, context, mode);\n      } else if (config.mode === 'n8n') {\n        return callN8NEndpoint(message, context, mode);\n      } else {\n        return generateLocalResponse(message, context, mode);\n      }\n    });\n    return function generateResponse(_x, _x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n  var callGroqAPI = function () {\n    var _ref3 = _asyncToGenerator(function* (message, context, mode) {\n      setIsLoading(true);\n      try {\n        var _data$choices, _data$choices$, _data$choices$$messag;\n        var systemPrompt = buildSystemPrompt(context, mode);\n        var conversationHistory = buildConversationHistory(context);\n        var response = yield fetch(GROQ_CONFIG.apiUrl, {\n          method: 'POST',\n          headers: {\n            'Authorization': `Bearer ${apiKey}`,\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({\n            model: GROQ_CONFIG.model,\n            messages: [{\n              role: 'system',\n              content: systemPrompt\n            }].concat(conversationHistory, [{\n              role: 'user',\n              content: message\n            }]),\n            max_tokens: GROQ_CONFIG.maxTokens,\n            temperature: getTemperatureForMode(mode)\n          })\n        });\n        if (!response.ok) {\n          var errorData = yield response.json().catch(function () {\n            return {};\n          });\n          console.error('Groq API error:', errorData);\n          throw new Error(`Groq API error: ${response.status}`);\n        }\n        var data = yield response.json();\n        var aiMessage = ((_data$choices = data.choices) == null ? void 0 : (_data$choices$ = _data$choices[0]) == null ? void 0 : (_data$choices$$messag = _data$choices$.message) == null ? void 0 : _data$choices$$messag.content) || 'No pude responder...';\n        setIsLoading(false);\n        var score = calculateScore(message, mode);\n        return {\n          response: aiMessage.trim(),\n          score: score,\n          color: getResponseColor(score),\n          sessionId: context.sessionId || `session_${Date.now()}`,\n          mode: mode,\n          rawData: data\n        };\n      } catch (error) {\n        console.error('Error en llamada a Groq:', error);\n        setIsLoading(false);\n        return generateLocalResponse(message, context, mode);\n      }\n    });\n    return function callGroqAPI(_x3, _x4, _x5) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n  var buildSystemPrompt = function buildSystemPrompt(context, mode) {\n    var patient = context.patient;\n    var difficulty = context.difficulty || 'normal';\n    var difficultyInstructions = {\n      entrenamiento: `\n        - Sé colaborativo y abierto con tus respuestas\n        - Proporciona información clara sobre tus síntomas\n        - Responde con detalle a las preguntas del terapeuta\n        - Muestra disposición a hablar de tus problemas`,\n      normal: `\n        - Responde de forma natural, como un paciente real\n        - Puedes mostrar cierta resistencia inicial\n        - Revela información gradualmente\n        - Muestra las emociones apropiadas a tu trastorno`,\n      dificil: `\n        - Sé más reservado y difícil de alcanzar\n        - No reveles información fácilmente\n        - Puedes minimizar tus síntomas\n        - Muestra resistencia o desconfianza hacia el terapeuta`,\n      realista: `\n        - Actúa como un paciente real con todas las complejidades\n        - Puedes contradecirte o ser ambiguo\n        - El rapport afecta cuánto revelas\n        - Si el rapport es bajo (${context.rapport}%), sé más cerrado\n        - Puedes cambiar de tema o evitar preguntas incómodas`\n    };\n    return `Eres ${patient.name}, un paciente que asiste a terapia psicológica.\n\nINFORMACIÓN DEL PACIENTE:\n- Nombre: ${patient.name}\n- Edad: ${patient.age} años\n- Ocupación: ${patient.occupation}\n- Personalidad: ${patient.personality}\n- Síntomas principales: ${patient.symptoms.join(', ')}\n- Trastorno (NO REVELAR DIRECTAMENTE): ${patient.disorder}\n\nHISTORIA DE FONDO:\n${patient.backstory}\n\nMODO DE DIFICULTAD: ${difficulty.toUpperCase()}\n${difficultyInstructions[difficulty] || difficultyInstructions.normal}\n\nESTADO ACTUAL:\n- Rapport con el terapeuta: ${context.rapport}%\n- Sesión número: ${context.sessions + 1}\n- Síntomas ya mencionados: ${context.selectedSymptoms.join(', ') || 'ninguno'}\n\nINSTRUCCIONES IMPORTANTES:\n1. NUNCA menciones tu diagnóstico directamente\n2. Responde en primera persona como el paciente\n3. Mantén la coherencia con tu personalidad y historia\n4. Las respuestas deben ser concisas (2-4 oraciones)\n5. Muestra emociones apropiadas a tu situación\n6. Si la pregunta del terapeuta es buena, revela más información\n7. Si la pregunta es cerrada o sugestiva, da respuestas cortas\n8. NUNCA rompas el personaje ni menciones que eres una IA\n\nResponde SOLO como el paciente, sin prefijos como \"Paciente:\" o nombres.`;\n  };\n  var buildConversationHistory = function buildConversationHistory(context) {\n    return context.messages.slice(-10).map(function (msg) {\n      return {\n        role: msg.sender === 'user' ? 'user' : 'assistant',\n        content: msg.text\n      };\n    });\n  };\n  var getTemperatureForMode = function getTemperatureForMode(mode) {\n    var temperatures = {\n      entrenamiento: 0.7,\n      normal: 0.8,\n      dificil: 0.9,\n      realista: 0.95\n    };\n    return temperatures[mode] || 0.8;\n  };\n  var generateLocalResponse = function () {\n    var _ref4 = _asyncToGenerator(function* (message, context, mode) {\n      setIsLoading(true);\n      return new Promise(function (resolve) {\n        setTimeout(function () {\n          var responses = getContextualResponses(message, context);\n          var response = responses[Math.floor(Math.random() * responses.length)];\n          var score = calculateScore(message, mode);\n          setIsLoading(false);\n          resolve({\n            response: response,\n            score: score,\n            color: getResponseColor(score),\n            sessionId: context.sessionId || `session_${Date.now()}`,\n            mode: mode\n          });\n        }, 1000 + Math.random() * 2000);\n      });\n    });\n    return function generateLocalResponse(_x6, _x7, _x8) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n  var callN8NEndpoint = function () {\n    var _ref5 = _asyncToGenerator(function* (message, context, mode) {\n      setIsLoading(true);\n      try {\n        var _context$patient, _context$patient2, _context$patient3, _context$patient4;\n        var controller = new AbortController();\n        var timeoutId = setTimeout(function () {\n          return controller.abort();\n        }, config.timeout);\n        var payload = {\n          doctorQuestion: message,\n          patientName: ((_context$patient = context.patient) == null ? void 0 : _context$patient.name) || 'Paciente',\n          disorder: ((_context$patient2 = context.patient) == null ? void 0 : _context$patient2.disorder) || 'Trastorno por determinar',\n          personality: ((_context$patient3 = context.patient) == null ? void 0 : _context$patient3.personality) || 'colaborativo',\n          symptoms: context.selectedSymptoms || ((_context$patient4 = context.patient) == null ? void 0 : _context$patient4.symptoms) || ['malestar general'],\n          mode: mode,\n          caseFileData: context,\n          conversationHistory: (context.messages || []).slice(-6).map(function (msg) {\n            return {\n              isUser: msg.sender === 'user',\n              text: msg.text,\n              timestamp: msg.timestamp\n            };\n          }),\n          sessionId: context.sessionId || `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n          questionCount: context.questionsThisSession || 0\n        };\n        var response = yield fetch(config.endpoint, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            Accept: 'application/json'\n          },\n          body: JSON.stringify(payload),\n          signal: controller.signal\n        });\n        clearTimeout(timeoutId);\n        if (!response.ok) {\n          throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n        }\n        var data = yield response.json();\n        setIsLoading(false);\n        return {\n          response: extractResponse(data),\n          score: calculateModeScore(data.score, mode, message),\n          color: getModeColor(data.color, mode),\n          sessionId: payload.sessionId,\n          mode: mode,\n          rawData: data\n        };\n      } catch (error) {\n        console.error('Error en llamada a n8n:', error);\n        setIsLoading(false);\n        return generateLocalResponse(message, context, mode);\n      }\n    });\n    return function callN8NEndpoint(_x9, _x0, _x1) {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n  var testConnection = function () {\n    var _ref6 = _asyncToGenerator(function* () {\n      if (config.mode === 'groq' && apiKey) {\n        try {\n          var response = yield fetch(GROQ_CONFIG.apiUrl, {\n            method: 'POST',\n            headers: {\n              'Authorization': `Bearer ${apiKey}`,\n              'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n              model: GROQ_CONFIG.model,\n              messages: [{\n                role: 'user',\n                content: 'test'\n              }],\n              max_tokens: 5\n            })\n          });\n          return response.ok;\n        } catch (_unused) {\n          return false;\n        }\n      }\n      try {\n        var _response = yield fetch(config.endpoint, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({\n            test: true,\n            message: 'Ping'\n          })\n        });\n        return _response.ok;\n      } catch (_unused2) {\n        return false;\n      }\n    });\n    return function testConnection() {\n      return _ref6.apply(this, arguments);\n    };\n  }();\n  var getContextualResponses = function getContextualResponses(message, context) {\n    var _patient$disorder, _patient$disorder2, _patient$disorder3, _patient$disorder4;\n    var msg = message.toLowerCase();\n    var patient = context.patient;\n    if (patient != null && (_patient$disorder = patient.disorder) != null && _patient$disorder.includes('depresion') || patient != null && (_patient$disorder2 = patient.disorder) != null && _patient$disorder2.includes('depresivo')) {\n      if (msg.includes('trabajo') || msg.includes('jefe')) {\n        return [\"El trabajo se ha vuelto muy pesado últimamente. Ya no tengo energía para cumplir con mis responsabilidades.\", \"Mi jefe no entiende lo que estoy pasando. Me siento incomprendido/a.\", \"Me cuesta concentrarme en mis tareas. A veces me quedo mirando la pantalla sin hacer nada.\"];\n      } else if (msg.includes('familia') || msg.includes('hijos') || msg.includes('pareja')) {\n        return [\"Siento que no soy el padre/madre que debería ser. Mis hijos merecen algo mejor.\", \"Mi pareja me pregunta qué me pasa, pero no sé cómo explicarlo.\", \"La relación con mi familia se ha vuelto difícil. Me aíslo sin querer.\"];\n      } else if (msg.includes('sueño') || msg.includes('dormir')) {\n        return [\"Me despierto muy temprano y ya no puedo volver a dormir. El insomnio me está matando.\", \"Duermo mucho pero nunca me siento descansado/a.\", \"Las noches son lo peor. Los pensamientos no me dejan en paz.\"];\n      } else if (msg.includes('cómo te sientes') || msg.includes('cómo estás')) {\n        return [\"No encuentro motivación para nada. Todo me parece gris.\", \"Me siento vacío/a por dentro, como si nada importara.\", \"He perdido interés en las cosas que antes me gustaban.\"];\n      }\n      return [\"Es difícil explicarlo... es como si llevara un peso encima todo el tiempo.\", \"No veo futuro, todo parece oscuro.\", \"A veces pienso que sería mejor no estar aquí... aunque no haría nada.\", \"Me cuesta hasta levantarme de la cama.\"];\n    }\n    if (patient != null && (_patient$disorder3 = patient.disorder) != null && _patient$disorder3.includes('ansiedad') || patient != null && (_patient$disorder4 = patient.disorder) != null && _patient$disorder4.includes('ansioso')) {\n      if (msg.includes('preocup') || msg.includes('miedo')) {\n        return [\"Estoy constantemente preocupado/a por todo. No puedo parar de pensar.\", \"Tengo miedo de que algo malo vaya a pasar, aunque no sé qué.\", \"Me angustia pensar en el futuro. ¿Y si todo sale mal?\"];\n      } else if (msg.includes('cuerpo') || msg.includes('físico')) {\n        return [\"Siento el pecho apretado todo el tiempo, como si no pudiera respirar bien.\", \"Me tiemblan las manos y tengo nudos en el estómago.\", \"A veces el corazón me late tan fuerte que creo que me va a dar algo.\"];\n      }\n      return [\"Me siento tenso/a todo el tiempo, como si algo malo fuera a pasar.\", \"No puedo controlar mis pensamientos negativos. Van a mil por hora.\", \"No puedo dormir bien por la ansiedad. Me despierto agitado/a.\", \"Mi cuerpo está siempre en alerta, preparado para huir.\"];\n    }\n    return [\"Es difícil hablar de esto... nunca lo había dicho en voz alta.\", \"No sé cómo explicarlo. Es complicado.\", \"Me siento confundido/a con todo lo que me pasa.\", \"¿Cree que tiene solución lo que me pasa?\", \"A veces pienso que no hay solución para esto.\"];\n  };\n  var calculateScore = function calculateScore(message, mode) {\n    var baseScore = Math.floor(Math.random() * 30) + 50;\n    var qualityBonus = 0;\n    if (/^(cómo|qué|cuándo|dónde|por qué|cuéntame|descríbeme|explícame|háblame)/i.test(message)) {\n      qualityBonus += 15;\n    }\n    if (/(debe ser difícil|imagino que|entiendo que|debe doler|te comprendo|parece que|suena)/i.test(message)) {\n      qualityBonus += 12;\n    }\n    if (/(entonces|lo que dices es|si te entiendo bien|me estás diciendo que)/i.test(message)) {\n      qualityBonus += 10;\n    }\n    if (/^(¿tienes|¿has|¿eres|¿te|¿hay|¿puedes)/i.test(message)) {\n      qualityBonus -= 8;\n    }\n    if (/(¿no crees que|¿no te parece que|¿verdad que|supongo que|¿no será que)/i.test(message)) {\n      qualityBonus -= 15;\n    }\n    if ((message.match(/\\?/g) || []).length > 1) {\n      qualityBonus -= 10;\n    }\n    if (message.length < 15) {\n      qualityBonus -= 5;\n    }\n    if (message.length > 50 && message.length < 150) {\n      qualityBonus += 5;\n    }\n    var multipliers = {\n      entrenamiento: 1.15,\n      normal: 1.0,\n      dificil: 0.9,\n      realista: 0.85\n    };\n    var score = (baseScore + qualityBonus) * (multipliers[mode] || 1.0);\n    return Math.max(0, Math.min(100, Math.round(score)));\n  };\n  var calculateModeScore = function calculateModeScore(baseScore, mode, question) {\n    var score = baseScore || calculateScore(question, mode);\n    return Math.max(0, Math.min(100, Math.round(score)));\n  };\n  var getResponseColor = function getResponseColor(score) {\n    if (score >= 80) return '#4CAF50';\n    if (score >= 65) return '#8BC34A';\n    if (score >= 50) return '#FF9800';\n    if (score >= 35) return '#FF5722';\n    return '#f44336';\n  };\n  var getModeColor = function getModeColor(baseColor, mode) {\n    if (baseColor) return baseColor;\n    return getResponseColor(50);\n  };\n  var extractResponse = function extractResponse(data) {\n    if (data.response) return data.response;\n    if (data.content) return data.content;\n    if (data.message) return data.message;\n    if (typeof data === 'string') return data;\n    return 'No pude procesar esa pregunta...';\n  };\n  return _jsx(AIContext.Provider, {\n    value: {\n      config: config,\n      setConfig: setConfig,\n      generateResponse: generateResponse,\n      testConnection: testConnection,\n      isLoading: isLoading,\n      setApiKey: setApiKey\n    },\n    children: children\n  });\n};","map":{"version":3,"names":["React","createContext","useContext","useState","jsx","_jsx","GROQ_CONFIG","apiUrl","model","maxTokens","temperature","AIContext","useAI","context","Error","AIProvider","_ref","children","_useState","mode","endpoint","timeout","_useState2","_slicedToArray","config","setConfigState","_useState3","_useState4","apiKey","setApiKeyState","_useState5","_useState6","isLoading","setIsLoading","setConfig","newConfig","prev","_objectSpread","setApiKey","key","generateResponse","_ref2","_asyncToGenerator","message","arguments","length","undefined","callGroqAPI","callN8NEndpoint","generateLocalResponse","_x","_x2","apply","_ref3","_data$choices","_data$choices$","_data$choices$$messag","systemPrompt","buildSystemPrompt","conversationHistory","buildConversationHistory","response","fetch","method","headers","body","JSON","stringify","messages","role","content","concat","max_tokens","getTemperatureForMode","ok","errorData","json","catch","console","error","status","data","aiMessage","choices","score","calculateScore","trim","color","getResponseColor","sessionId","Date","now","rawData","_x3","_x4","_x5","patient","difficulty","difficultyInstructions","entrenamiento","normal","dificil","realista","rapport","name","age","occupation","personality","symptoms","join","disorder","backstory","toUpperCase","sessions","selectedSymptoms","slice","map","msg","sender","text","temperatures","_ref4","Promise","resolve","setTimeout","responses","getContextualResponses","Math","floor","random","_x6","_x7","_x8","_ref5","_context$patient","_context$patient2","_context$patient3","_context$patient4","controller","AbortController","timeoutId","abort","payload","doctorQuestion","patientName","caseFileData","isUser","timestamp","toString","substr","questionCount","questionsThisSession","Accept","signal","clearTimeout","statusText","extractResponse","calculateModeScore","getModeColor","_x9","_x0","_x1","testConnection","_ref6","_unused","test","_unused2","_patient$disorder","_patient$disorder2","_patient$disorder3","_patient$disorder4","toLowerCase","includes","baseScore","qualityBonus","match","multipliers","max","min","round","question","baseColor","Provider","value"],"sources":["C:/Users/macer/Desktop/MAC/APP/PSKYAT/PSYKAT3.0/react/src/contexts/AIContext.tsx"],"sourcesContent":["import React, { createContext, useContext, useState, ReactNode } from 'react';\nimport { AIConfig, AIResponse, Case } from '../types';\n\n// Configuración de Groq\nconst GROQ_CONFIG = {\n  apiUrl: 'https://api.groq.com/openai/v1/chat/completions',\n  model: 'llama-3.1-70b-versatile', // Modelo más capaz\n  maxTokens: 500,\n  temperature: 0.8,\n};\n\n// Contexto de IA\ninterface AIContextType {\n  config: AIConfig;\n  setConfig: (config: Partial<AIConfig>) => void;\n  generateResponse: (message: string, context: Case, mode?: string) => Promise<AIResponse>;\n  testConnection: () => Promise<boolean>;\n  isLoading: boolean;\n  setApiKey: (key: string) => void;\n}\n\nconst AIContext = createContext<AIContextType | null>(null);\n\n// Hook personalizado\nexport const useAI = () => {\n  const context = useContext(AIContext);\n  if (!context) {\n    throw new Error('useAI debe ser usado dentro de AIProvider');\n  }\n  return context;\n};\n\n// Provider\ninterface AIProviderProps {\n  children: ReactNode;\n}\n\nexport const AIProvider: React.FC<AIProviderProps> = ({ children }) => {\n  const [config, setConfigState] = useState<AIConfig>({\n    mode: 'local', // 'local' | 'groq' | 'n8n'\n    endpoint: 'https://api.groq.com/openai/v1/chat/completions',\n    timeout: 30000,\n  });\n\n  const [apiKey, setApiKeyState] = useState<string>('');\n  const [isLoading, setIsLoading] = useState(false);\n\n  // Función para actualizar configuración\n  const setConfig = (newConfig: Partial<AIConfig>) => {\n    setConfigState(prev => ({ ...prev, ...newConfig }));\n  };\n\n  // Función para guardar API key\n  const setApiKey = (key: string) => {\n    setApiKeyState(key);\n    // Cambiar a modo Groq si hay key\n    if (key) {\n      setConfig({ mode: 'groq' as any });\n    }\n  };\n\n  // Función para generar respuesta\n  const generateResponse = async (\n    message: string,\n    context: Case,\n    mode: string = 'entrenamiento'\n  ): Promise<AIResponse> => {\n    if (config.mode === 'groq' && apiKey) {\n      return callGroqAPI(message, context, mode);\n    } else if (config.mode === 'n8n') {\n      return callN8NEndpoint(message, context, mode);\n    } else {\n      return generateLocalResponse(message, context, mode);\n    }\n  };\n\n  // Llamada a Groq API\n  const callGroqAPI = async (\n    message: string,\n    context: Case,\n    mode: string\n  ): Promise<AIResponse> => {\n    setIsLoading(true);\n\n    try {\n      const systemPrompt = buildSystemPrompt(context, mode);\n      const conversationHistory = buildConversationHistory(context);\n\n      const response = await fetch(GROQ_CONFIG.apiUrl, {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${apiKey}`,\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          model: GROQ_CONFIG.model,\n          messages: [\n            { role: 'system', content: systemPrompt },\n            ...conversationHistory,\n            { role: 'user', content: message },\n          ],\n          max_tokens: GROQ_CONFIG.maxTokens,\n          temperature: getTemperatureForMode(mode),\n        }),\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}));\n        console.error('Groq API error:', errorData);\n        throw new Error(`Groq API error: ${response.status}`);\n      }\n\n      const data = await response.json();\n      const aiMessage = data.choices?.[0]?.message?.content || 'No pude responder...';\n\n      setIsLoading(false);\n\n      const score = calculateScore(message, mode);\n\n      return {\n        response: aiMessage.trim(),\n        score,\n        color: getResponseColor(score),\n        sessionId: context.sessionId || `session_${Date.now()}`,\n        mode,\n        rawData: data,\n      };\n\n    } catch (error) {\n      console.error('Error en llamada a Groq:', error);\n      setIsLoading(false);\n      // Fallback a respuesta local\n      return generateLocalResponse(message, context, mode);\n    }\n  };\n\n  // Construir prompt del sistema\n  const buildSystemPrompt = (context: Case, mode: string): string => {\n    const patient = context.patient;\n    const difficulty = context.difficulty || 'normal';\n\n    const difficultyInstructions: { [key: string]: string } = {\n      entrenamiento: `\n        - Sé colaborativo y abierto con tus respuestas\n        - Proporciona información clara sobre tus síntomas\n        - Responde con detalle a las preguntas del terapeuta\n        - Muestra disposición a hablar de tus problemas`,\n      normal: `\n        - Responde de forma natural, como un paciente real\n        - Puedes mostrar cierta resistencia inicial\n        - Revela información gradualmente\n        - Muestra las emociones apropiadas a tu trastorno`,\n      dificil: `\n        - Sé más reservado y difícil de alcanzar\n        - No reveles información fácilmente\n        - Puedes minimizar tus síntomas\n        - Muestra resistencia o desconfianza hacia el terapeuta`,\n      realista: `\n        - Actúa como un paciente real con todas las complejidades\n        - Puedes contradecirte o ser ambiguo\n        - El rapport afecta cuánto revelas\n        - Si el rapport es bajo (${context.rapport}%), sé más cerrado\n        - Puedes cambiar de tema o evitar preguntas incómodas`,\n    };\n\n    return `Eres ${patient.name}, un paciente que asiste a terapia psicológica.\n\nINFORMACIÓN DEL PACIENTE:\n- Nombre: ${patient.name}\n- Edad: ${patient.age} años\n- Ocupación: ${patient.occupation}\n- Personalidad: ${patient.personality}\n- Síntomas principales: ${patient.symptoms.join(', ')}\n- Trastorno (NO REVELAR DIRECTAMENTE): ${patient.disorder}\n\nHISTORIA DE FONDO:\n${patient.backstory}\n\nMODO DE DIFICULTAD: ${difficulty.toUpperCase()}\n${difficultyInstructions[difficulty] || difficultyInstructions.normal}\n\nESTADO ACTUAL:\n- Rapport con el terapeuta: ${context.rapport}%\n- Sesión número: ${context.sessions + 1}\n- Síntomas ya mencionados: ${context.selectedSymptoms.join(', ') || 'ninguno'}\n\nINSTRUCCIONES IMPORTANTES:\n1. NUNCA menciones tu diagnóstico directamente\n2. Responde en primera persona como el paciente\n3. Mantén la coherencia con tu personalidad y historia\n4. Las respuestas deben ser concisas (2-4 oraciones)\n5. Muestra emociones apropiadas a tu situación\n6. Si la pregunta del terapeuta es buena, revela más información\n7. Si la pregunta es cerrada o sugestiva, da respuestas cortas\n8. NUNCA rompas el personaje ni menciones que eres una IA\n\nResponde SOLO como el paciente, sin prefijos como \"Paciente:\" o nombres.`;\n  };\n\n  // Construir historial de conversación\n  const buildConversationHistory = (context: Case): Array<{ role: string; content: string }> => {\n    return context.messages.slice(-10).map(msg => ({\n      role: msg.sender === 'user' ? 'user' : 'assistant',\n      content: msg.text,\n    }));\n  };\n\n  // Temperatura según modo\n  const getTemperatureForMode = (mode: string): number => {\n    const temperatures: { [key: string]: number } = {\n      entrenamiento: 0.7,\n      normal: 0.8,\n      dificil: 0.9,\n      realista: 0.95,\n    };\n    return temperatures[mode] || 0.8;\n  };\n\n  // Respuestas simuladas locales (fallback)\n  const generateLocalResponse = async (\n    message: string,\n    context: Case,\n    mode: string\n  ): Promise<AIResponse> => {\n    setIsLoading(true);\n\n    return new Promise((resolve) => {\n      setTimeout(() => {\n        const responses = getContextualResponses(message, context);\n        const response = responses[Math.floor(Math.random() * responses.length)];\n        const score = calculateScore(message, mode);\n\n        setIsLoading(false);\n\n        resolve({\n          response,\n          score,\n          color: getResponseColor(score),\n          sessionId: context.sessionId || `session_${Date.now()}`,\n          mode,\n        });\n      }, 1000 + Math.random() * 2000);\n    });\n  };\n\n  // Llamada a n8n (mantener compatibilidad)\n  const callN8NEndpoint = async (\n    message: string,\n    context: Case,\n    mode: string\n  ): Promise<AIResponse> => {\n    setIsLoading(true);\n\n    try {\n      const controller = new AbortController();\n      const timeoutId = setTimeout(() => controller.abort(), config.timeout);\n\n      const payload = {\n        doctorQuestion: message,\n        patientName: context.patient?.name || 'Paciente',\n        disorder: context.patient?.disorder || 'Trastorno por determinar',\n        personality: context.patient?.personality || 'colaborativo',\n        symptoms: context.selectedSymptoms || context.patient?.symptoms || ['malestar general'],\n        mode,\n        caseFileData: context,\n        conversationHistory: (context.messages || [])\n          .slice(-6)\n          .map((msg: any) => ({\n            isUser: msg.sender === 'user',\n            text: msg.text,\n            timestamp: msg.timestamp,\n          })),\n        sessionId: context.sessionId || `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n        questionCount: context.questionsThisSession || 0,\n      };\n\n      const response = await fetch(config.endpoint, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          Accept: 'application/json',\n        },\n        body: JSON.stringify(payload),\n        signal: controller.signal,\n      });\n\n      clearTimeout(timeoutId);\n\n      if (!response.ok) {\n        throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n      }\n\n      const data = await response.json();\n\n      setIsLoading(false);\n\n      return {\n        response: extractResponse(data),\n        score: calculateModeScore(data.score, mode, message),\n        color: getModeColor(data.color, mode),\n        sessionId: payload.sessionId,\n        mode,\n        rawData: data,\n      };\n\n    } catch (error) {\n      console.error('Error en llamada a n8n:', error);\n      setIsLoading(false);\n      return generateLocalResponse(message, context, mode);\n    }\n  };\n\n  // Función para probar conexión\n  const testConnection = async (): Promise<boolean> => {\n    if (config.mode === 'groq' && apiKey) {\n      try {\n        const response = await fetch(GROQ_CONFIG.apiUrl, {\n          method: 'POST',\n          headers: {\n            'Authorization': `Bearer ${apiKey}`,\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify({\n            model: GROQ_CONFIG.model,\n            messages: [{ role: 'user', content: 'test' }],\n            max_tokens: 5,\n          }),\n        });\n        return response.ok;\n      } catch {\n        return false;\n      }\n    }\n\n    try {\n      const response = await fetch(config.endpoint, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ test: true, message: 'Ping' }),\n      });\n      return response.ok;\n    } catch {\n      return false;\n    }\n  };\n\n  // Funciones auxiliares\n  const getContextualResponses = (message: string, context: Case): string[] => {\n    const msg = message.toLowerCase();\n    const patient = context.patient;\n\n    // Respuestas basadas en el trastorno\n    if (patient?.disorder?.includes('depresion') || patient?.disorder?.includes('depresivo')) {\n      if (msg.includes('trabajo') || msg.includes('jefe')) {\n        return [\n          \"El trabajo se ha vuelto muy pesado últimamente. Ya no tengo energía para cumplir con mis responsabilidades.\",\n          \"Mi jefe no entiende lo que estoy pasando. Me siento incomprendido/a.\",\n          \"Me cuesta concentrarme en mis tareas. A veces me quedo mirando la pantalla sin hacer nada.\"\n        ];\n      } else if (msg.includes('familia') || msg.includes('hijos') || msg.includes('pareja')) {\n        return [\n          \"Siento que no soy el padre/madre que debería ser. Mis hijos merecen algo mejor.\",\n          \"Mi pareja me pregunta qué me pasa, pero no sé cómo explicarlo.\",\n          \"La relación con mi familia se ha vuelto difícil. Me aíslo sin querer.\"\n        ];\n      } else if (msg.includes('sueño') || msg.includes('dormir')) {\n        return [\n          \"Me despierto muy temprano y ya no puedo volver a dormir. El insomnio me está matando.\",\n          \"Duermo mucho pero nunca me siento descansado/a.\",\n          \"Las noches son lo peor. Los pensamientos no me dejan en paz.\"\n        ];\n      } else if (msg.includes('cómo te sientes') || msg.includes('cómo estás')) {\n        return [\n          \"No encuentro motivación para nada. Todo me parece gris.\",\n          \"Me siento vacío/a por dentro, como si nada importara.\",\n          \"He perdido interés en las cosas que antes me gustaban.\",\n        ];\n      }\n      return [\n        \"Es difícil explicarlo... es como si llevara un peso encima todo el tiempo.\",\n        \"No veo futuro, todo parece oscuro.\",\n        \"A veces pienso que sería mejor no estar aquí... aunque no haría nada.\",\n        \"Me cuesta hasta levantarme de la cama.\"\n      ];\n    }\n\n    if (patient?.disorder?.includes('ansiedad') || patient?.disorder?.includes('ansioso')) {\n      if (msg.includes('preocup') || msg.includes('miedo')) {\n        return [\n          \"Estoy constantemente preocupado/a por todo. No puedo parar de pensar.\",\n          \"Tengo miedo de que algo malo vaya a pasar, aunque no sé qué.\",\n          \"Me angustia pensar en el futuro. ¿Y si todo sale mal?\"\n        ];\n      } else if (msg.includes('cuerpo') || msg.includes('físico')) {\n        return [\n          \"Siento el pecho apretado todo el tiempo, como si no pudiera respirar bien.\",\n          \"Me tiemblan las manos y tengo nudos en el estómago.\",\n          \"A veces el corazón me late tan fuerte que creo que me va a dar algo.\"\n        ];\n      }\n      return [\n        \"Me siento tenso/a todo el tiempo, como si algo malo fuera a pasar.\",\n        \"No puedo controlar mis pensamientos negativos. Van a mil por hora.\",\n        \"No puedo dormir bien por la ansiedad. Me despierto agitado/a.\",\n        \"Mi cuerpo está siempre en alerta, preparado para huir.\"\n      ];\n    }\n\n    // Respuestas genéricas\n    return [\n      \"Es difícil hablar de esto... nunca lo había dicho en voz alta.\",\n      \"No sé cómo explicarlo. Es complicado.\",\n      \"Me siento confundido/a con todo lo que me pasa.\",\n      \"¿Cree que tiene solución lo que me pasa?\",\n      \"A veces pienso que no hay solución para esto.\"\n    ];\n  };\n\n  const calculateScore = (message: string, mode: string): number => {\n    let baseScore = Math.floor(Math.random() * 30) + 50;\n\n    let qualityBonus = 0;\n\n    // Preguntas abiertas (+puntos)\n    if (/^(cómo|qué|cuándo|dónde|por qué|cuéntame|descríbeme|explícame|háblame)/i.test(message)) {\n      qualityBonus += 15;\n    }\n\n    // Empatía (+puntos)\n    if (/(debe ser difícil|imagino que|entiendo que|debe doler|te comprendo|parece que|suena)/i.test(message)) {\n      qualityBonus += 12;\n    }\n\n    // Reflejo/Parafraseo (+puntos)\n    if (/(entonces|lo que dices es|si te entiendo bien|me estás diciendo que)/i.test(message)) {\n      qualityBonus += 10;\n    }\n\n    // Preguntas cerradas (-puntos)\n    if (/^(¿tienes|¿has|¿eres|¿te|¿hay|¿puedes)/i.test(message)) {\n      qualityBonus -= 8;\n    }\n\n    // Preguntas sugestivas (-puntos)\n    if (/(¿no crees que|¿no te parece que|¿verdad que|supongo que|¿no será que)/i.test(message)) {\n      qualityBonus -= 15;\n    }\n\n    // Preguntas múltiples (-puntos)\n    if ((message.match(/\\?/g) || []).length > 1) {\n      qualityBonus -= 10;\n    }\n\n    // Preguntas muy cortas (-puntos)\n    if (message.length < 15) {\n      qualityBonus -= 5;\n    }\n\n    // Preguntas bien formuladas y largas (+puntos)\n    if (message.length > 50 && message.length < 150) {\n      qualityBonus += 5;\n    }\n\n    const multipliers: { [key: string]: number } = {\n      entrenamiento: 1.15,\n      normal: 1.0,\n      dificil: 0.9,\n      realista: 0.85,\n    };\n\n    const score = (baseScore + qualityBonus) * (multipliers[mode] || 1.0);\n    return Math.max(0, Math.min(100, Math.round(score)));\n  };\n\n  const calculateModeScore = (baseScore: number, mode: string, question: string): number => {\n    let score = baseScore || calculateScore(question, mode);\n    return Math.max(0, Math.min(100, Math.round(score)));\n  };\n\n  const getResponseColor = (score: number): string => {\n    if (score >= 80) return '#4CAF50'; // Verde\n    if (score >= 65) return '#8BC34A'; // Verde claro\n    if (score >= 50) return '#FF9800'; // Naranja\n    if (score >= 35) return '#FF5722'; // Naranja oscuro\n    return '#f44336'; // Rojo\n  };\n\n  const getModeColor = (baseColor: string, mode: string): string => {\n    if (baseColor) return baseColor;\n    return getResponseColor(50);\n  };\n\n  const extractResponse = (data: any): string => {\n    if (data.response) return data.response;\n    if (data.content) return data.content;\n    if (data.message) return data.message;\n    if (typeof data === 'string') return data;\n    return 'No pude procesar esa pregunta...';\n  };\n\n  return (\n    <AIContext.Provider value={{\n      config,\n      setConfig,\n      generateResponse,\n      testConnection,\n      isLoading,\n      setApiKey,\n    }}>\n      {children}\n    </AIContext.Provider>\n  );\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}